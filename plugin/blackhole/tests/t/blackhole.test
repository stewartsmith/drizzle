# Basic test routine for the Blackhole Engine

--disable_warnings
drop table if exists t1;
--enable_warnings

# Test with Variable Width Table
CREATE TABLE t1 (c1 int, c2 text, c3 blob) ENGINE=blackhole;

INSERT INTO t1 VALUES (111, "aaaa", "aaaa");
INSERT INTO t1 VALUES (222, "bbbb", "bbbb");
INSERT INTO t1 VALUES (333, "cccc", "cccc");

SELECT * FROM t1;

UPDATE t1 SET c2 = "xxxx" WHERE c1 = 111;
UPDATE t1 SET c2 = "yyyy" WHERE c1 = 222;
UPDATE t1 SET c2 = "zzzz" WHERE c1 = 333;

SELECT * FROM t1;

REPLACE INTO t1 VALUES (1, "one", "one");
REPLACE INTO t1 VALUES (2, "two", "two");
REPLACE INTO t1 VALUES (3, "three", "three");

SELECT * FROM t1;

DELETE FROM t1 WHERE c1 = 111;
DELETE FROM t1 WHERE c1 = 222;
DELETE FROM t1;

SELECT * FROM t1;

DROP TABLE t1;


# Test with Fixed Length Table + Primary Key
CREATE TABLE t1 (id int primary key, c1 int, c2 double) ENGINE=blackhole;

INSERT INTO t1 VALUES (1, 1111, 11.111);
INSERT INTO t1 VALUES (2, 2222, 22.222);
INSERT INTO t1 VALUES (3, 3333, 33.333);
drop table t1;

# Double check that read locks are still being honored by the kernel.
CREATE TABLE t5 (a int) ENGINE=BLACKHOLE;
INSERT INTO t5 VALUES (1);
FLUSH TABLES WITH READ LOCK;
--error ER_CANT_UPDATE_WITH_READLOCK
INSERT INTO t5 VALUES (1);
UNLOCK TABLES;
INSERT INTO t5 VALUES (1);
FLUSH TABLES WITH READ LOCK;
--error ER_CANT_UPDATE_WITH_READLOCK
DROP TABLE t5;
UNLOCK TABLES;
INSERT INTO t5 VALUES (1);
DROP TABLE t5;

# Test for bug lp:492046
CREATE SCHEMA foo;
use foo;
CREATE TABLE A (A INT) ENGINE=BLACKHOLE;
DROP SCHEMA foo;

# Test for bug lp:617517
use test;
CREATE TABLE t1 (a int) ENGINE=INNODB;
ALTER TABLE t1 ENGINE=BLACKHOLE;
SHOW TABLES;
