# Test routine for range queries using BlitzDB

--disable_warnings
drop table if exists t1;
--enable_warnings

# +-----------------+
# | INDEX TYPE: INT |
# +-----------------+
create table t1 (a int, index(a)) engine = blitzdb;

insert into t1 values (1),(2),(3),(4),(5),(6),(7),(8),(9),(10);
insert into t1 values (11),(12),(13),(14),(15),(16),(17),(18),(19),(20);
insert into t1 values (21),(22),(23),(24),(25),(26),(27),(28),(29),(30);
insert into t1 values (31),(32),(33),(34),(35),(36),(37),(38),(39),(40);
insert into t1 values (41),(42),(43),(44),(45),(46),(47),(48),(49),(50);
insert into t1 values (51),(52),(53),(54),(55),(56),(57),(58),(59),(60);

select count(*) from t1;
select max(a) from t1;
select min(a) from t1;

explain select * from t1 where a <= 30;
select * from t1 where a <= 30;

explain select * from t1 where a > 30;
select * from t1 where a > 30;

explain select * from t1 where a <= 10 limit 1;
select * from t1 where a <= 10 limit 1;

explain select * from t1 where a < 20 order by a desc;
select * from t1 where a < 20 order by a desc;

explain select * from t1 where a <= 10 order by a desc limit 1;
select * from t1 where a <= 10 order by a desc limit 1;

explain select * from t1 where a between 30 and 40;
select * from t1 where a between 30 and 40;

explain select * from t1 where a in (10, 20, 30, 40, 50, 60);
select * from t1 where a in (10, 20, 30, 40, 50, 60);

# Impossible Cases
select * from t1 where a > 60;
select * from t1 where a < 0;
select * from t1 where a > 20 and a < 20;
select * from t1 where a is NULL;
drop table t1;

# +--------------------+
# | INDEX TYPE: BIGINT |
# +--------------------+
create table t1 (a bigint, index(a)) engine = blitzdb;

insert into t1 values (1),(2),(3),(4),(5),(6),(7),(8),(9),(10);
insert into t1 values (11),(12),(13),(14),(15),(16),(17),(18),(19),(20);
insert into t1 values (21),(22),(23),(24),(25),(26),(27),(28),(29),(30);
insert into t1 values (31),(32),(33),(34),(35),(36),(37),(38),(39),(40);
insert into t1 values (41),(42),(43),(44),(45),(46),(47),(48),(49),(50);
insert into t1 values (51),(52),(53),(54),(55),(56),(57),(58),(59),(60);

explain select * from t1 where a <= 30;
select * from t1 where a <= 30;

explain select * from t1 where a > 30;
select * from t1 where a > 30;

explain select * from t1 where a <= 10 limit 1;
select * from t1 where a <= 10 limit 1;

explain select * from t1 where a < 20 order by a desc;
select * from t1 where a < 20 order by a desc;
select * from t1 where a < 5 order by a desc;

explain select * from t1 where a <= 10 order by a desc limit 1;
select * from t1 where a <= 10 order by a desc limit 1;

explain select * from t1 where a between 30 and 40;
select * from t1 where a between 30 and 40;

explain select * from t1 where a in (10, 20, 30, 40, 50, 60);
select * from t1 where a in (10, 20, 30, 40, 50, 60);

# Impossible Cases
select * from t1 where a > 60;
select * from t1 where a < 0;
select * from t1 where a > 20 and a < 20;
select * from t1 where a is NULL;
drop table t1;

# +--------------------+
# | INDEX TYPE: DOUBLE |
# +--------------------+
create table t1 (a double, index(a)) engine = blitzdb;

insert into t1 values (1.4), (1.3), (0.9), (1.0), (1.2), (1.1);

--sorted_result
select * from t1;
explain select * from t1;

# Full Range
select * from t1 where a < 2.0;
select * from t1 where a > 0.01;

# Half Range
select * from t1 where a <= 1.1;
select * from t1 where a > 1.1;

# Partial
select * from t1 where a in (0.9, 1.4, 1.1);

# Sort
select * from t1 where a < 1.3 order by a;
select * from t1 where a < 1.3 order by a desc;

# Impossible Cases
select * from t1 where a > 2.0;
select * from t1 where a < 0.01;
select * from t1 where a > 1.0 and a < 1.0;
select * from t1 where a is NULL;

drop table t1;

# +------------------+
# | INDEX TYPE: DATE |
# +------------------+
create table t1 (a date, index(a)) engine = blitzdb;

insert into t1 values ('2000-07-10'), ('2000-07-11'), ('2000-07-12');
insert into t1 values ('2000-08-13'), ('2000-08-14'), ('2000-08-15');
insert into t1 values ('2001-07-10'), ('2001-07-11'), ('2001-07-12');
insert into t1 values ('2001-08-13'), ('2001-08-14'), ('2001-08-15');
insert into t1 values ('2002-07-10'), ('2002-07-11'), ('2002-07-12');
insert into t1 values ('2002-08-13'), ('2002-08-14'), ('2002-08-15');
insert into t1 values ('2003-07-10'), ('2003-07-11'), ('2003-07-12');
insert into t1 values ('2003-08-13'), ('2003-08-14'), ('2003-08-15');
insert into t1 values ('2004-07-10'), ('2004-07-11'), ('2004-07-12');
insert into t1 values ('2004-08-13'), ('2004-08-14'), ('2004-08-15');

# lower range
explain select * from t1 where a < '2002-01-01';
select * from t1 where a < '2002-01-01';

# partial range
explain select * from t1 where a between '2002-01-01' and '2002-12-31';
select * from t1 where a between '2002-01-01' and '2002-12-31';

# full range
explain select * from t1 where a > '2000-01-01' and a < '2004-12-31';
select * from t1 where a > '2000-01-01' and a < '2004-12-31';
select count(*) from t1 where a > '2000-01-01' and a < '2004-12-31';

# sort
explain select * from t1 where a < '2002-07-10' order by a;
select * from t1 where a < '2002-07-10' order by a;
explain select * from t1 where a < '2002-07-10' order by a desc;
select * from t1 where a < '2002-07-10' order by a desc;

# out of bounds
select * from t1 where a > '2022-01-01';
select * from t1 where a < '2000-01-01';

# basic
select count(*) from t1;
select * from t1;
drop table t1;
